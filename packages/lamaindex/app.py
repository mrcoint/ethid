from flask import Flask, request
from flask_cors import CORS, cross_origin
import string
from llama_index.core import StorageContext, load_index_from_storage

# My OpenAI Key
import os
os.environ['OPENAI_API_KEY'] = "GTP API KEY"

# rebuild storage context
storage_context = StorageContext.from_defaults(persist_dir="./index/ai_index")

# load index
index = load_index_from_storage(storage_context)
query_engine = index.as_query_engine()

app = Flask("EthID ChatBot")
CORS(app) # This will enable CORS for all routes
#CORS(app, resources={r"/ask": {"origins": "http://localhost:3000"}})
nounce_vibe = "Nouns DAO has a vibe that's both innovative and community-oriented. It's like a bustling marketplace of creativity and collaboration, where people come together to tokenize and trade nouns. There's a sense of excitement and experimentation, with members actively participating in shaping the direction of the DAO and exploring the possibilities of decentralized ownership and governance. It's a space where imagination meets technology, fostering a culture of exploration and expression."
nounce_vibe_prompt = nounce_vibe + " In this vibe, answer the following question in a short one sentence response no more than ten words or jargon, as a customer service representative: \n\n"


@app.route("/")
def hello_world():
    return "<p>Hello, World!</p>"

@app.route("/ask")
def ask_question():
    question = request.args.get('q') 
    if(len(question) > 0):
        answer = query_engine.query(nounce_vibe_prompt + question)
        print (answer)
        print(type(str(answer)))
        return str(answer)
    return "I didn't get your question, please try asking in a different way."




